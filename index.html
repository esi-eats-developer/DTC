<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Eland ESI(외식, 바이오헬스케어)">

        <!-- 본 웹에 대한 설명 -->
        <meta name="keywords" content=""/>
        <meta name="description" content=""> 

        <!-- 링크 공유 시 보여지는 내용 설정 -->
        <meta property="og:type" content="website"> 
        <meta property="og:title" content="">
        <meta property="og:description" content="">
        <meta property="og:image" content="">
        <meta property="og:url" rel="canonical" content="">

        <title>탭에 표시될 문구 설정</title>
        <!-- 탭에 표시되는 작은 아이콘 설정 -->
        <!-- <link rel="shortcut icon" href="./image/favicon.PNG">  -->

        <!-- 웹 디자인 -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        <!-- <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/ajax.css"> -->
        <link rel="stylesheet" href="style.css">

        <!-- 웹 개발에 응용되는 cdn 및 javascript 파일 -->
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    </head>

    <body>
        <!-- 설문 시작 전 메인 페이지 -->
        <article class="start">
            <div class="survey-wrap">
                <div class="survey-contents">
                    <div class="survey-start">
                        <div class="start-header">
                            <!-- 로고 삽입 가능 -->
                            <span class="icon"></span> 
                            <h2>
                                <span>건강기능식품 큐레이션 서비스</span>
                                <br>
                                "선물용 맞춤 상품"
                            </h2>
                        </div>
                        <div class="start-info">
                            <p>
                            "몇 가지 질문에 답하고 "
                            <br>
                            "특별한 선물을 위한 맞춤 상품을 추천 받아보세요."
                            <br>
                            <br>
                            <span>약 2분 정도 소요됩니다.</span>
                            </p>
                            <div class="btn-wrap">
                                <a href="#" id="btn-start" class="btn btn-radius btn-dark" onclick="start();">시작하기</a>
                                <p class="warning">* 질병의 진단 및 치료는 전문적인 의료기관을 이용하세요.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </article>

        <!-- 설문 페이지 -->
        <article class="survey">
            <div class="survey-wrap">
                <div class="survey-contents">
                    <div class="survey-test">
                        <!-- 설문 진행 단계를 보여주는 파트 - 선물 추천용에서는 필요하지 않을 수 있음 -->
                        <!-- <nav class="survey-test-header">
                            <ul class="step-list-wrap">
                                <li data="기본정보">
                                    <span>기본정보</span>
                                    ::after
                                </li>
                                <li data="증상/불편">
                                    <span>증상/불편</span>
                                    ::after
                                </li>
                                <li data="생활 습관">
                                    <span>생활 습관</span>
                                    ::after
                                </li>
                                <li data="기타">
                                    <span>기타</span>
                                    ::after
                                </li>
                            </ul>
                        </nav> -->
                        <!-- 프로그레스바 -->
                        <div class="progress survey-progress">
                            <div id="survey-progress-rate" class="progress-bar" role="progressbar" style="width: calc(100/4*1%);" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <!-- 질문&답변 -->
                        <div class="survey-question-contents">
                            <section class="question-section">
                                <!-- 질문 번호 --><p id="qNum">질문 1</p>
                                <!-- 질문 -->
                                <h2 id="qTitle">
                                    <p>질문</p>
                                    <span></span>
                                </h2>
                                <p id="qContent"></p>
                                <!-- 답변 -->
                                <ul class="question-answer-wrap">
                                    <li>
                                        <div class="question-input-field">
                                            <div id="A">
                                                <input type="radio" name="question-answer" value="selection1">
                                                <label id="selection1" for="selection1">선택 1</label>
                                            </div>
                                            <div id="B">
                                                <input type="radio" name="question-answer" value="selection2">
                                                <label id="selection2" for="selection2">선택 2</label>
                                            </div>
                                            <div id="C">
                                                <input type="radio" name="question-answer" value="selection3">
                                                <label id="selection3" for="selection3">선택 3</label>
                                            </div>
                                            <div id="D">
                                                <input type="radio" name="question-answer" value="selection4">
                                                <label id="selection4" for="selection4">선택 4</label>
                                            </div>
                                            <div id="E">
                                                <input type="radio" name="question-answer" value="selection5">
                                                <label id="selection5" for="selection5">선택 5</label>
                                            </div>
                                            <!-- <button id="A" type="button" class="btn btn-answer btn-radius">선택1</button>
                                            <button id="B" type="button" class="btn btn-answer btn-radius">선택2</button>
                                            <button id="C" type="button" class="btn btn-answer btn-radius">선택3</button>
                                            <button id="D" type="button" class="btn btn-answer btn-radius">선택4</button> -->
                                        </div>
                                    </li>
                                </ul>
                            </section>
                        </div>
                        <!-- 에러 메시지 -->
                        <div class="survey-errormsg"></div>
                        <!-- 하단 구성 -->
                        <div class="survey-question-footer">
                            <!-- <button id="btn-prev" class="btn btn-radius">이전</button> -->
                            <button id="btn-next" class="btn btn-radius btn-dark">다음</button>
                        </div>
                    </div>
                </div>
            </div>
        </article>

        <!-- 솔루션 페이지 -->
        <!-- <article class="solution">
        </article> -->

        <script type="text/javascript" src="./js/question.js"></script>
        <!-- <script type="text/javascript" src="./js/solution.js"></script> -->
        <script type="text/javascript" >

            $(".survey").hide(); // 메인 페이지에 등장하지 않도록 숨김 처리

            var num = 1;

            function start(){
                $(".start").hide();
                $(".survey").show();
                next();
            }

            // $("#btn-prev").click(function() {
            //     if(num != 1){back();}
            //     if(num == 1){
            //         $(".survey").hide();
            //         $(".start").show();
            //     }
            // });

            $("#btn-next").click(function() {
                if(num < 5){
                    saveAnswer();
                    deselect();
                    next();

                    if(num == 5){
                        $(".survey").hide();
                        // goEland();
                    }
                }
            });

            function deselect(){
                $("input:radio[name='question-answer']").prop("checked", false);
                num++;
            }

            function recommendCategory(){
                var age = localStorage.getItem("age");
                var sex = localStorage.getItem("sex");
                var category = "";

                if(age == "청소년(10대)"){
                    category = "A1MF";
                }
                else if(age == "청년(20-30대)"){
                    category = "A2MF";
                }
                else if(age == "중장년(40-50대)"){
                    if(sex == "남성"){
                        category = "A3M"
                    }

                    if(sex == "여성"){
                        category = "A3F"
                    } 
                }
                else {
                    category = "A4MF"
                }

                return category
            }

            function visibility(n){
                var x = q[n]["selectionNum"];

                if(x == 2){
                    $("#C").attr("style", "display: none");
                    $("#D").attr("style", "display: none");
                    $("#E").attr("style", "display: none");
                }

                if(x == 3){
                    $("#C").attr("style", "display: ");
                    $("#D").attr("style", "display: none");
                    $("#E").attr("style", "display: none");
                }

                if(x == 4){
                    $("#C").attr("style", "display: ");
                    $("#D").attr("style", "display: ");
                    $("#E").attr("style", "display: none");
                }

                if(x == 5){
                    $("#C").attr("style", "display: ");
                    $("#D").attr("style", "display: ");
                    $("#E").attr("style", "display: ");
                }
            }

            function next(){
                if(num<=4){
                    // 프로그레스 바 진행 현황 변경
                    $("#survey-progress-rate").attr("style", "width:calc(100/4*"+num+"%)");

                    $("#qNum").text("질문 "+num);
                    $("#qTitle").html(q[num]["title"]);

                    if(num == 3){
                        var division = recommendCategory();

                        q[num]["seletionNum"] = category[division]["answerNum"];
                        
                        q[num]["A"] = category[division]["W1"];
                        q[num]["B"] = category[division]["W2"];
                        q[num]["C"] = category[division]["W3"];
                        q[num]["D"] = category[division]["W4"];
                        q[num]["E"] = category[division]["W5"];
                    }

                    $("#selection1").html(q[num]["A"]);
                    $("#selection2").html(q[num]["B"]);
                    $("#selection3").html(q[num]["C"]);
                    $("#selection4").html(q[num]["D"]);
                    $("#selection5").html(q[num]["E"]);
                }
                visibility(num);
            }

            function saveAnswer(){

                if(!window.localStorage){
                    //모든 브라우저가 HTML5 로컬스토리지 지원해서 이 구문은 안 써도 됨.
                    alert("현재 브라우저는 로컬스토리지를 지원하지 않습니다");
                    return false;
                }

                console.log($("input:radio[name='question-answer']").is(":checked"));
                
                if($("input:radio[name='question-answer']").is(":checked")){
                    var key = q[num]["question-type"];
                    var radioID = $("input[name='question-answer']:checked").val();
                    var radioNm = $("label[for='"+radioID+"']").text();

                    // console.log(key);
                    // console.log(radioID);
                    // console.log(radioNm);
                    
                    localStorage.setItem(key, radioNm);
                }
            }    


            function goEland(){
                let giftCategory = localStorage.getItem("category");
                let giftPrice = localStorage.getItem("price");

                if(giftCategory == "수면/스트레스"){giftCategory = "C1"}
                if(giftCategory == "눈"){giftCategory = "C2"}
                if(giftCategory == "두뇌 활동"){giftCategory = "C3"}
                if(giftCategory == "피로/간"){giftCategory = "C4"}
                if(giftCategory == "체지방/운동능력"){giftCategory = "C5"}
                if(giftCategory == "피부 관리"){giftCategory = "C6"}
                if(giftCategory == "뼈/관절"){giftCategory = "C7"}
                if(giftCategory == "여성 건강(갱년기)"){giftCategory = "C8"}
                if(giftCategory == "치아/잇몸"){giftCategory = "C9"}

                console.log(giftCategory);
                console.log(giftPrice);

                if(giftPrice == "전체"){location.href = purchase[giftCategory]["T"];}
                if(giftPrice == "10만원 이상"){location.href = purchase[giftCategory]["H"];}
                if(giftPrice == "10만원 미만"){location.href = purchase[giftCategory]["L"];}
            }

            // function back(){
            //     console.log(num);
            //     // 프로그레스 바 진행 현황 변경
            //     $("#survey-progress-rate").attr("style", "width:calc(100/4*"+(num-1)+"%)");

            //     $("#qNum").text("질문 "+ (num-1));
            //     $("#qTitle").html(q[num-1]["title"]);

            //     // 선택지의 개수에 따라, 버튼 display(보임 여부) 설정
            //     if(q[num-1]["selectionNum"]==3){
            //         $(".C").attr("style", "display: ");
            //         $(".D").attr("style", "display: none");
            //     }
            //     else if(q[num-1]["selectionNum"]==4){
            //         $(".C").attr("style", "display: ");
            //         $(".D").attr("style", "display: ");
            //     }
            //     else{
            //         $(".C").attr("style", "display: none");
            //         $(".D").attr("style", "display: none");
            //     }

            //     $("#A").html(q[num-1]["A"]);
            //     $("#B").html(q[num-1]["B"]);
            //     $("#C").html(q[num-1]["C"]);
            //     $("#D").html(q[num-1]["D"]);

            //     num--;
            //     console.log(num);
            // }

        </script>
    </body>
</html>